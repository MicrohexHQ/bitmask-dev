# This script gets executed inside the docker-bundler-apt image.
# (no virtualenv, so all the dependencies must be already installed in the image).

: ${REPO:="https://github.com/leapcode/bitmask-dev"}
: ${BRANCH:="master"}

# build bitmask-systray

export GOPATH=/srv/go
go get 0xacab.org/leap/bitmask-systray
cd /src/leap && git clone https://0xacab.org/leap/bitmask-systray
cd bitmask-systray && go build .


cd /src/leap/bitmask-dev
RELEASE=bitmask-`cat pkg/next-version`
cd $HOME
echo "[+] CLONING REPO from $REPO [$BRANCH]"
git clone $REPO bitmaskbuild
cd bitmaskbuild
git checkout $BRANCH
git fetch --tags
mkdir -p dist/

# nuke mail
rm -rf src/leap/bitmask/mail
cp /src/leap/bitmask-systray/bitmask-systray dist/${RELEASE}/lib/
VIRTUAL_ENV=/usr/local make bundle_linux
cp -r dist/* /dist

